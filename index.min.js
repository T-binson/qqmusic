$(function(){function s(){var s=$(".song_lists>li.song_list"),i=$(".song_lists>li.song_title>span"),e=$(".play_tool .pause");s.remove(),i.removeClass("list_checked"),e.removeClass("play"),y[0].pause(),u.splice(0,s.length),clearInterval(L),P[0].innerText="",S[0].innerText="",Y[0].innerText="00:00",N[0].innerText="00:00",b.css("width",0),k.css("left",0),C[0].innerHTML="",C.css("marginTop",75)}function i(){$(".btn-del").click(function(){s(),$(".popup-win").css("display","none")}),$(".btn-cel").click(function(){$(".popup-win").css("display","none")}),$(".delkey").click(function(){$(".popup-win").css("display","none")})}function e(){$(".btn-del").click(function(){if($(".list_checked").siblings().find(".icons i:first-child").hasClass("icon-play")){if(f=$(".icon-play").parentsUntil(".song_lists").eq(4).index(),f===$(".song_lists>li.song_list").length)f=1;else{var s=$(".song_lists>li.song_list>span:not(.list_checked)");$.each(s,function(s,i){return $(i).parent().index()>f?(f=$(i).parent().index(),!1):void 0})}var i=$($(".song_list").get(f-1)).find(".icons i:first-child"),e=$($(".song_list").get(f-1)).find(".list_number"),a=$($(".song_list").get(f-1)).find(".name"),t=$($(".song_list").get(f-1)).find(".song_singer");C[0].innerHTML="",C.css("marginTop",75),i.addClass("icon-play"),e.addClass("wave"),e.find("b").fadeOut(0),a.addClass("active"),t.addClass("active"),c(y,$(".song_list").get(f-1)),o(),r(f-1),g(P,S,Y,N,f-1);var l=0;$.each($(".list_checked"),function(s,i){l=$(i).parent().index()-s-1,u.splice(l,1)})}else if(f){var d=u[f-1],p=0;if($.each($(".list_checked"),function(s,i){p=$(i).parent().index()-s-1,u.splice(p,1)}),-1===u.indexOf(d)){var v=$(".song_lists>li.song_list>span:not(.list_checked)");$.each(v,function(s,i){return $(i).parent().index()>f?(f=$(i).parent().index(),!1):void 0})}else f=u.indexOf(d)+1;C[0].innerHTML="",C.css("marginTop",75)}else{var _=0;$.each($(".list_checked"),function(s,i){_=$(i).parent().index()-s-1,u.splice(_,1)})}$(".list_checked").parent().remove(),n(),$(".song_list").find(".icons i:first-child").hasClass("icon-play")&&(f=$(".icon-play").parentsUntil(".song_lists").eq(4).index()),$(".popup-win").css("display","none")}),$(".btn-cel").click(function(){$(".popup-win").css("display","none")}),$(".delkey").click(function(){$(".popup-win").css("display","none")})}function n(){var s=$(".song_lists>li.song_list").find("b");$.each(s.splice(0,s.length),function(s,i){i.innerText=s+1})}function a(s,i,e,n){var a=$(".list_number"),l=$(".song_list .name"),d=$(".song_list .song_singer");if($($(".song_list").get(i-1)).find(".icons").children().eq(0).removeClass("icon-play"),a.eq(i-1).removeClass("wave"),a.eq(i-1).find("b").fadeIn(0),l.eq(i-1).removeClass("active"),d.eq(i-1).removeClass("active"),C[0].innerHTML="",s.hasClass("mode2")){if(i>=e)return n[0].pause(),clearInterval(L),void $(".play_tool .pause").removeClass("play");f+=1}else s.hasClass("mode0")?i>=e?f=1:f+=1:s.hasClass("mode1")?f=i:s.hasClass("mode3")&&(f=t(1,e));c($("audio"),$(".song_list").get(f-1)),o(),r(f-1),g(P,S,Y,N,f-1),$($(".song_list").get(f-1)).find(".icons").children().eq(0).addClass("icon-play"),a.eq(f-1).addClass("wave"),a.eq(f-1).find("b").fadeOut(0),l.eq(f-1).addClass("active"),d.eq(f-1).addClass("active")}function t(s,i){return parseInt(Math.random()*(i-s+1))}function l(){v=$("audio")[0].duration,curTime=$("audio")[0].currentTime,w=O*(curTime/v),$(".line_front").css("width",w),$(".dot").css("left",w),Y[0].innerText=p(curTime),v===curTime&&a($(".mode"),f,$(".song_list").length,$("audio")),-1!==h.indexOf(p(curTime))&&(C.children().removeClass("highlight"),$(C.children()[h.indexOf(p(curTime))]).addClass("highlight"),lihg=C.find(".highlight").index(),C.stop().animate({marginTop:-lihg*$(".highlight").height()+50},300))}function o(){clearInterval(L);C.css("marginTop",50),L=setInterval(l,1e3)}function c(s,i,e){var n=u[$(i).index()-1].src;s.attr("src",n),e&&(s[0].currentTime=e),s[0].play()}function d(){$.ajax({url:"source/songlists.json",dataType:"json",type:"GET",success:function(s){for(var i=s.length,e="",n=0;i>n;n++){var a='\n					<li class="song_list">\n							<span></span>\n							<div>\n								<div class="song_name">\n									<ul>\n										<li class="name">\n											<span class="list_number"><b>'+(n+1)+"</b></span>"+s[n].songname+'\n										</li>\n										<li class="icons">\n											<i title="播放" ></i>\n											<i class="icon-add" title="添加"></i>\n											<i class="icon-share" title="分享"></i>\n										</li>\n									</ul>\n								</div>\n								<div class="song_singer"> '+s[n].singer+'\n								</div>\n								<div class="song_time">\n									<span class="time">'+s[n].durationtime+'</span>\n									<span class="del" title="删除"></span>\n								</div>\n							</div>\n						</li>';e+=a}$(".song_lists").append($(e)),u=s},error:function(){alert("the internet doesn't work!")}})}function r(s){var i="";$.ajax({url:u[s].lyric,type:"GET",dataType:"text",success:function(s){var e=/(\d*:\d*)\.\d*\](.*)/g,n=s.match(e);h=[],m=[];for(var a=0;a<n.length;a++){var t=n[a].split("]");h.push(t[0].split(".")[0]),m.push(t[1])}for(var l=0;l<h.length;l++)i+="<li>"+m[l]+"</li>";C[0].innerHTML=i},error:function(s){console.log(s)}})}function g(s,i,e,n,a,t){$("title").text(u[a].songname+" - "+u[a].singer),s.text(u[a].songname),i.text(u[a].singer),X.innerText=u[a].album,Y[0].innerText=t?p(t):"00:00",N[0].innerText=u[a].durationtime}function p(s){var i=parseInt(s/60);10>i&&(i="0"+i);var e=parseInt(s%60);return 10>e&&(e="0"+e),i+":"+e}$(".music_lists").mCustomScrollbar(),$(".music_lists").delegate(".song_lists>li>span","click",function(){$(this).toggleClass("list_checked"),"song_title"===$(this).parent().attr("class")?$(this).hasClass("list_checked")?$(this).parent().siblings("li").find("span").addClass("list_checked"):$(this).parent().siblings("li").find("span").removeClass("list_checked"):($(this).hasClass("list_checked")||$(".song_title>span").eq(0).removeClass("list_checked"),$(".song_list>.list_checked").length===$(".song_list>span").length&&$(".song_title>span").eq(0).addClass("list_checked"))});var u,f,v,_,h=[],m=[],C=$(".lyrics ul"),y=$("audio"),b=$(".line_front"),k=$(".dot");d(),$(".top_bar .empty").click(function(){0!==$(".song_list").length&&($(".popup-win").css("display","block"),$(".remove").css("display","none"),$(".clear").css("display","block"),i())}),$(".top_bar .delete").click(function(){0!==$(".song_list").length&&$(".song_lists>li>span").hasClass("list_checked")&&($(".popup-win").css("display","block"),$(".clear").css("display","none"),$(".remove").css("display","block"),$(".song_lists>li.song_title>span").hasClass("list_checked")&&i(),$(".song_lists>li.song_list").find("span").hasClass("list_checked")&&e())}),$(".song_lists").delegate(".song_time .del","click",function(){f=$(".icon-play").parentsUntil(".song_lists").eq(4).index(),f===$(".song_list").length&&(f=1);var s=$(this).parentsUntil(".song_lists").eq(2);if(u.splice(s.index()-1,1),s.remove(),C[0].innerHTML="",C.css("marginTop",75),s.find(".icons i:first-child").hasClass("icon-play")){var i=$($(".song_list").get(f-1)).find(".icons i:first-child"),e=$($(".song_list").get(f-1)).find(".list_number"),a=$($(".song_list").get(f-1)).find(".name"),t=$($(".song_list").get(f-1)).find(".song_singer");i.addClass("icon-play"),e.addClass("wave"),e.find("b").fadeOut(0),a.addClass("active"),t.addClass("active"),c(y,$(".song_list").get(f-1)),o(),r(f-1),g(P,S,Y,N,f-1)}n(),f=$(".icon-play").parentsUntil(".song_lists").eq(4).index()}),$(".song_lists").delegate("li.icons i:first-child","click",function(){$(this).toggleClass("icon-play"),f=$(this).parentsUntil(".song_lists").eq(4).index();var s=$(this).parent().siblings("li").find(".list_number"),i=$(this).parent().siblings(".name"),e=i.parent().parent().siblings(".song_singer");$(this).hasClass("icon-play")?(s.addClass("wave"),s.find("b").fadeOut(0),i.addClass("active"),e.addClass("active"),$(".play_tool .pause").addClass("play"),c(y,$(".song_list").get(f-1),_),o(U),r(f-1),g(P,S,Y,N,f-1,_),_=0):(s.removeClass("wave"),s.find("b").fadeIn(0),i.removeClass("active"),e.removeClass("active"),$(".play_tool .pause").removeClass("play"),$("audio")[0].pause(),_=$("audio")[0].currentTime,clearInterval(L));var n=$(this).parentsUntil(".song_lists").eq(4).siblings();n.find(".icons>i:first-child").removeClass("icon-play"),n.find(".list_number").removeClass("wave").find("b").fadeIn(0),n.find(".name").removeClass("active"),n.find(".song_singer").removeClass("active")}),$(".play_tool .pause").click(function(){if(0!==$(".song_list").length){f>$(".song_list").length&&(f=1),$(this).toggleClass("play");var s;$(this).hasClass("play")?(f?(s=$(".song_list").get(f-1),$(s).find("i:first-child").eq(0).addClass("icon-play"),$(s).find(".list_number").eq(0).addClass("wave").find("b").fadeOut(0),$(s).find(".name").eq(0).addClass("active"),$(s).find(".song_singer").eq(0).addClass("active"),f=$(".icon-play").parentsUntil(".song_lists").eq(4).index()):($("li.icons i:first-child").eq(0).addClass("icon-play"),$(".list_number").eq(0).addClass("wave").find("b").fadeOut(0),$(".name").eq(0).addClass("active"),$(".song_singer").eq(1).addClass("active"),f=1,s=$(".song_list").get(0)),c($("audio"),s,_),o(),r(f-1),g(P,S,Y,N,f-1,_)):($("li.icons i:first-child").removeClass("icon-play"),$(".list_number").removeClass("wave").find("b").fadeIn(0),$(".name").removeClass("active"),$(".song_singer").removeClass("active"),$("audio")[0].pause(),_=$("audio")[0].currentTime,clearInterval(L))}}),$(".play_tool .pre").click(function(){if($(".play_tool .pause").hasClass("play")&&1!==$(".song_list").length&&f){var s=$(".list_number"),i=$(".song_list .name"),e=$(".song_list .song_singer");$($(".song_list").get(f-1)).find(".icons").children().eq(0).removeClass("icon-play"),s.eq(f-1).removeClass("wave"),s.eq(f-1).find("b").fadeIn(0),i.eq(f-1).removeClass("active"),e.eq(f-1).removeClass("active"),C[0].innerHTML="",C.css("marginTop",75),1===f?f=$(".song_list").length:f>$(".song_list").length?f=1:f-=1,$($(".song_list").get(f-1)).find(".icons").children().eq(0).addClass("icon-play"),s.eq(f-1).addClass("wave"),s.eq(f-1).find("b").fadeOut(0),i.eq(f-1).addClass("active"),e.eq(f-1).addClass("active"),c(y,$(".song_list").get(f-1)),o(),r(f-1),g(P,S,Y,N,f-1)}}),$(".play_tool .next").click(function(){if($(".play_tool .pause").hasClass("play")&&1!==$(".song_list").length&&f){var s=$(".list_number"),i=$(".song_list .name"),e=$(".song_list .song_singer");$($(".song_list").get(f-1)).find(".icons").children().eq(0).removeClass("icon-play"),s.eq(f-1).removeClass("wave"),s.eq(f-1).find("b").fadeIn(0),i.eq(f-1).removeClass("active"),e.eq(f-1).removeClass("active"),C[0].innerHTML="",C.css("marginTop",75),f>=$(".song_list").length?f=1:f+=1,$($(".song_list").get(f-1)).find(".icons").children().eq(0).addClass("icon-play"),s.eq(f-1).addClass("wave"),s.eq(f-1).find("b").fadeOut(0),i.eq(f-1).addClass("active"),e.eq(f-1).addClass("active"),c(y,$(".song_list").get(f-1)),o(),r(f-1),g(P,S,Y,N,f-1)}});var q=["mode0","mode1","mode2","mode3"],T=0,x=q.length;$(".mode").click(function(){var s=$(this);q.forEach(function(i,e){s.hasClass(i)&&(s.removeClass(i),T=e)}),T++,T>x-1&&(T=0),s.addClass(q[T])}),$(".dislike").click(function(){$(this).toggleClass("like")}),$(".pure").click(function(){$(this).toggleClass("pureon"),$(".lyrics").toggleClass("fullpage"),$(".lyrics div").toggleClass("container")}),$(".volume>a").click(function(){$(this).toggleClass("silent"),$("audio")[0].muted=!$("audio")[0].muted});var w,I=$(".line_back").offset().left,O=$(".line_back").width();$(".bot").click(function(s){s.stopPropagation(),clearInterval(L),w=s.pageX-I,w>O-2?w=O:2>w&&(w=0);var i=w/O;$("audio")[0].currentTime=$("audio")[0].duration*i,_=$("audio")[0].duration*i,$(".line_front").css("width",w),$(".dot").css("left",w),Y[0].innerText=p($("audio")[0].duration*i);var e=C.find("li"),n=e.length-1;C.stop().animate({marginTop:-(50+n*e.height())*i},500),e.eq(parseInt(n*i-1)).addClass("highlight"),o()});var M,H=!1;$(".dot").mousedown(function(){f&&(H=!0,clearInterval(L),$(".progress_bar").mousemove(function(s){w=s.pageX-I,w>O?w=O:0>w&&(w=0),M=w/O,$(".dot").css("left",w),$(".line_front").css("width",w),Y[0].innerText=p($("audio")[0].duration*M);var i=C.find("li"),e=i.length-1;C.stop().animate({marginTop:-(50+e*i.height())*M},500),i.eq(parseInt(e*M-1)).addClass("highlight")}))}),$(".progress_bar").mouseup(function(){$(".progress_bar").off("mousemove"),H&&($("audio")[0].currentTime=$("audio")[0].duration*M,_=$("audio")[0].duration*M,H=!H),o()});var L,U,j,E=$(".vol_back").height(),G=$(".vol_back").offset().top;$(".volume_progress").click(function(s){s.stopPropagation(),j=E-(s.pageY-G),j>E-2?j=E:2>j&&(j=0);var i=j/E;$("audio")[0].volume=i,$(".vol_front").css("height",j),$(".vol_dot").css("bottom",j)}),$(".vol_dot").mousedown(function(){$(document).mousemove(function(s){j=E-(s.pageY-G),j>E?j=E:0>j&&(j=0);var i=j/E;$("audio")[0].volume=i,$(".vol_dot").css("bottom",j),$(".vol_front").css("height",j)})}),$(document).mouseup(function(){$(document).off("mousemove")});var P=$(".curName"),S=$(".curSinger"),X=$(".collection")[0],Y=$(".progress_bar .top .right .ct"),N=$(".progress_bar .top .right .tt")});