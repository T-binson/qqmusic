$(function(){function e(e){$(".popup-win").css("display","block"),e.css("display","none"),$(".delkey").on("click",function(){e.css("display","block"),$(".popup-win").css("display","none"),$(".btn-del").off("click")}),$(".btn-cel").on("click",function(){e.css("display","block"),$(".popup-win").css("display","none"),$(".btn-del").off("click")})}function s(){$(".btn-del").on("click",function(){$(".popup-win").css("display","none"),$(".s-item").remove(),$(".s-title .square").removeClass("active"),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),C.splice(0,$(".s-item").length),clearInterval(W),clearInterval(_),Q.text(""),R.text(""),Y[0].innerText="00:00",Z[0].innerText="00:00",V.innerText="",K.attr("src","../images/cover10.png"),es.css({backgroundImage:"url(../images/cover10.png)",transition:"all 1s"}),$(".bot .song-bar").css("width",0),$(".bot .cache-bar").css("width",0),$(".bot .dot").css("left",0),L[0].innerHTML="",L.css("marginTop",0),$(this).off("click")})}function i(e){$.each(e.splice(0,e.length),function(e,s){s.innerText=e+1})}function n(){var e=$(".s-item").eq(T);e.find(".play").addClass("playing"),e.find(".play").addClass("playing"),e.find(".s-num").addClass("wave"),e.find(".s-num").find("b").fadeOut(0),e.find(".song").addClass("actived"),e.find(".s-singer").addClass("actived"),e.find(".icons").css("opacity",1),e.find(".s-time").find("i").css("display","inline-block"),e.find(".s-time").find("span").css("display","none"),L[0].innerHTML="",L.css("marginTop",0),f($("audio"),$(".s-item").eq(T)),_=setInterval(m,0),p(),h(T),y(Q,R,Y,Z,T)}function a(){var e=$(".s-item .square:not(.active)");$.each(e,function(e,s){return $(s).parent().index()>T?(T=$(s).parent().index(),!1):void 0})}function t(){var e=0;$.each($(".active"),function(s,i){e=$(i).parent().index()-s,C.splice(e,1)})}function l(e){e.num.addClass("wave").find("b").fadeOut(0),e.song.addClass("actived"),e.singer.addClass("actived"),e.icons.css("opacity","1"),e.time.find("i").css("display","inline-block"),e.time.find("span").css("display","none")}function o(e){e.num.removeClass("wave").find("b").fadeIn(0),e.song.removeClass("actived"),e.singer.removeClass("actived"),e.icons.attr("style",""),e.time.find("i").attr("style",""),e.time.find("span").attr("style","")}function r(e,s,i,n){$(".play").eq(s).removeClass("playing");var a={num:$(".s-num").eq(s+1),song:$(".song").eq(s+1),singer:$(".s-singer").eq(s+1),icons:$(".icons").eq(s),time:$(".s-time").eq(s+1)};if(o(a),L[0].innerHTML="",L.css("marginTop",0),e.hasClass("mode2")){if(s>=i)return n[0].pause(),clearInterval(W),clearInterval(_),void $(".play-key .pause").removeClass("play");T+=1}else e.hasClass("mode0")?s>=i?T=0:T+=1:e.hasClass("mode1")?T=s:e.hasClass("mode3")&&(T=c(0,i));f($("audio"),$(".s-item").eq(T)),_=setInterval(m,0),p(),h(T),y(Q,R,Y,Z,T),$(".play").eq(T).addClass("playing");var t={num:$(".s-num").eq(T+1),song:$(".song").eq(T+1),singer:$(".s-singer").eq(T+1),icons:$(".icons").eq(T),time:$(".s-time").eq(T+1)};l(t)}function c(e,s){return parseInt(Math.random()*(s-e+1))}function d(e){for(var s=0,i=3;e>i;i++)s-=L.find("li").eq(i).height();return s}function u(e,s,i,n){n>e?n=e:0>n&&(n=0),s.css("width",n),i.css("left",n)}function g(){x=$("audio")[0].duration,curTime=$("audio")[0].currentTime,P=$(".bot .progress").width()*(curTime/x),$(".bot .song-bar").css("width",P),$(".bot .dot").css("left",P),Y[0].innerText=b(curTime),x===curTime&&r($(".mode"),T,$(".s-item").length-1,$("audio")),-1!==w.indexOf(b(curTime))&&(L.children().removeClass("highlight"),$(L.children()[w.indexOf(b(curTime))]).addClass("highlight"),lihg=L.find(".highlight").index(),window.innerWidth>767?lihg>2&&L.stop().animate({marginTop:d(lihg)-L.find("li").eq(lihg-2).height()},300):lihg>0&&L.stop().animate({marginTop:d(lihg)-L.find("li").eq(lihg-2).height()},300))}function p(){clearInterval(W);W=setInterval(g,1e3)}function m(){if($("audio")[0].buffered.length>0){var e=$("audio")[0].buffered,s=e.end(e.length-1);if(s===$("audio")[0].duration)$(".bot .cache-bar").css("width",$(".bot .progress").width()),clearInterval(_);else{if(e===B)return;B=e;var i=s/$("audio")[0].duration,n=$(".bot .progress").width()*i;$(".bot .cache-bar").css("width",n)}}}function f(e,s,i){var n=C[s.index()].src;e.attr("src",n),i&&(e[0].currentTime=i),e[0].play()}function v(e){$.ajax({url:e,dataType:"json",type:"GET",success:function(e){for(var s=e.length,i="",n=0;s>n;n++){var a='<li class="s-item">\n								<span class="square"></span>\n								<div class="row">\n									<div class="s-name col-7 col-md-7">\n										<div>\n											<i class="s-num"><b>'+(n+1)+'</b></i>\n											<p class="song">'+e[n].songname+'</p>\n										</div>\n										<ul class="icons">\n											<li><a href="javascript:;" class="play"></a></li>\n											<li><a href="javascript:;" class="download"></a></li>\n											<li><a href="javascript:;" class="add"></a></li>\n											<li><a href="javascript:;" class="share"></a></li>\n										</ul>\n									</div>\n									<div class="s-singer col-3 col-md-3">'+e[n].singer+'</div>\n									<div class="s-time col-2 col-md-2">\n										<i class="del"></i>\n										<span class="duration">'+e[n].duration+"</span>\n									</div>\n								</div>\n						</li>";i+=a}$("#mCSB_1_container").append($(i)),C=e},error:function(){alert("the internet doesn't work!")}})}function h(e){var s="";$.ajax({url:C[e].lyric,type:"GET",dataType:"text",success:function(e){var i=/(\d*:\d*)\.\d*\](.*)/g,n=e.match(i);w=[],I=[],M=[];for(var a=0;a<n.length;a++){var t=n[a].split("]");t[1]&&(M.push(t[0]),w.push(t[0].split(".")[0]),I.push(t[1]))}for(var l=0;l<w.length;l++)s+="<li>"+I[l]+"</li>";L[0].innerHTML=s,q(M),M.splice(0,M.length/2)},error:function(e){console.log(e)}})}function y(e,s,i,n,a,t){e.text(C[a].songname),$("title").text(C[a].songname+" - "+C[a].singer),s.text(C[a].singer),V.innerText=C[a].album,K.attr("src",C[a].cover),es.css("backgroundImage","url("+C[a].cover+")"),Y[0].innerText=t?b(t):"00:00",Z[0].innerText=C[a].duration}function b(e){var s=parseInt(e/60);10>s&&(s="0"+s);var i=parseInt(e%60);return 10>i&&(i="0"+i),s+":"+i}function q(e){$.each(e,function(s,i){e.push(Number(60*Number(i.slice(0,2))+Number(i.slice(3,5))+i.slice(5)))})}$(".s-lists").mCustomScrollbar();var C,T,x,k,w=[],I=[],M=[],H="source/songlists.json";v(H);var L=$(".m-lrc ul");$(".m-lists").delegate(".square","click",function(){$(this).toggleClass("active"),"s-title"===$(this).parent().attr("class")?$(this).hasClass("active")?$(".square").addClass("active"):$(".square").removeClass("active"):$(".s-lists .square").length===$(".s-lists .active").length?$(".s-title .square").addClass("active"):$(".s-title .square").removeClass("active")}),$(".navbar .empty").click(function(){0!==$(".s-item").length&&(e($(".remove")),s())}),$(".navbar .delete").click(function(){0!==$(".s-item").length&&$(".square").hasClass("active")&&(e($(".clear")),$(".s-title .square").hasClass("active")&&s(),$(".s-item .square").hasClass("active")&&$(".btn-del").on("click",function(){if($(".popup-win").css("display","none"),$(".clear").css("display","block"),$(".active").siblings().find(".play").hasClass("playing")){if(T=$(".playing").parentsUntil(".s-lists").eq(4).index(),T===$(".s-item").length-1)if($(".mode").hasClass("mode0"))T=0;else{if(!$(".mode").hasClass("mode3"))return $(".active").parent().remove(),t(),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),clearInterval(W),clearInterval(_),Q.text(""),R.text(""),Y[0].innerText="00:00",Z[0].innerText="00:00",V.innerText="",K.attr("src","../images/cover10.png"),es.css({backgroundImage:"url(../images/cover10.png)",transition:"all 1s"}),$(".bot .song-bar").css("width",0),$(".bot .cache-bar").css("width",0),$(".bot .dot").css("left",0),L[0].innerHTML="",void L.css("marginTop",0);T=c(1,$(".s-item").length-2)}else a();clearInterval(_),n(),t()}else if(T){var e=C[T];t(),-1===C.indexOf(e)?a():T=C.indexOf(e)}else t();$(".active").parent().remove();var s=$(".s-num b");i(s),$(".s-item").find(".play").hasClass("playing")&&(T=$(".playing").parentsUntil(".s-lists").eq(4).index()),$(this).off("click")}))}),$(".s-lists").delegate(".del","click",function(){var e=$(this).parentsUntil(".s-lists").eq(2),s=e.siblings().find("b");if(e.find(".play").hasClass("playing")){if(T=$(".playing").parentsUntil(".s-lists").eq(4).index(),1===$(".s-item").length)return e.remove(),C.splice(e.index(),1),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),clearInterval(W),clearInterval(_),Q.text(""),R.text(""),Y[0].innerText="00:00",Z[0].innerText="00:00",V.innerText="",K.attr("src","../images/cover10.png"),es.css({backgroundImage:"url(../images/cover10.png)",transition:"all 1s"}),$(".bot .song-bar").css("width",0),$(".bot .cache-bar").css("width",0),$(".bot .dot").css("left",0),L[0].innerHTML="",void L.css("marginTop",0);if(T===$(".s-item").length-1)if($(".mode").hasClass("mode0"))T=0;else{if(!$(".mode").hasClass("mode3"))return e.remove(),C.splice(e.index(),1),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),clearInterval(W),clearInterval(_),Q.text(""),R.text(""),Y[0].innerText="00:00",Z[0].innerText="00:00",V.innerText="",K.attr("src","../images/cover10.png"),es.css({backgroundImage:"url(../images/cover10.png)",transition:"all 1s"}),$(".bot .song-bar").css("width",0),$(".bot .cache-bar").css("width",0),$(".bot .dot").css("left",0),L[0].innerHTML="",void L.css("marginTop",0);T=c(1,$(".s-item").length-2)}else T+=1;clearInterval(_),n()}C.splice(e.index(),1),e.remove(),i(s),$(".s-item").find(".play").hasClass("playing")&&(T=$(".playing").parentsUntil(".s-lists").eq(4).index())});var j;$(".s-lists").delegate(".play","click",function(){$(this).toggleClass("playing"),T=$(this).parentsUntil(".s-lists").eq(4).index();var e=$(this).parentsUntil(".row"),s=e.eq(2),i={num:s.find(".s-num"),icons:e.eq(1),song:s.find(".song"),singer:s.siblings(".s-singer"),time:s.siblings(".s-time")};$(this).hasClass("playing")?(l(i),$(".play-key .pause").addClass("played"),T!==j&&(k=0,L.css("marginTop",0)),f($("audio"),$(".s-item").eq(T),k),_=setInterval(m,0),p(),h(T),y(Q,R,Y,Z,T,k)):(o(i),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),k=$("audio")[0].currentTime,j=T,clearInterval(W));var n=$(this).parentsUntil(".s-lists").eq(4).siblings(),a={num:n.find(".s-num"),song:n.find(".song"),singer:n.find(".s-singer"),icons:n.find(".icons"),time:n.find(".s-time")};n.find(".play").removeClass("playing"),o(a)}),$(".play-key .pause").click(function(){if(0!==$(".s-item").length){T>$(".s-item").length-1&&(T=0),$(this).toggleClass("played");var e;if($(this).hasClass("played")){if(void 0===T){$(".play").eq(0).addClass("playing"),_=setInterval(m,0);var s={num:$(".s-num").eq(1),song:$(".song").eq(1),singer:$(".s-singer").eq(1),icons:$(".icons").eq(0),time:$(".s-time").eq(1)};l(s),T=0,e=$(".s-item").eq(0)}else{e=$(".s-item").eq(T),e.find(".play").addClass("playing");var i={num:e.find(".s-num"),song:e.find(".song"),singer:e.find(".s-singer"),icons:e.find(".icons"),time:e.find(".s-time")};l(i)}f($("audio"),e,k),p(),h(T),y(Q,R,Y,Z,T,k)}else{$(".play").removeClass("playing");var n={num:$(".s-num"),song:$(".song"),singer:$(".s-singer"),icons:$(".icons"),time:$(".s-time")};o(n),$("audio")[0].pause(),k=$("audio")[0].currentTime,clearInterval(W)}}}),$(".play-key .pre").click(function(){if($(".play-key .pause").hasClass("played")&&1!==$(".s-item").length&&!(0>T)){$(".play").eq(T).removeClass("playing");var e={num:$(".s-num").eq(T+1),song:$(".song").eq(T+1),singer:$(".s-singer").eq(T+1),icons:$(".icons").eq(T),time:$(".s-time").eq(T+1)};o(e),L[0].innerHTML="",L.css("marginTop",0),clearInterval(_),0===T?T=$(".s-item").length-1:T>$(".s-item").length-1?T=0:T-=1,$(".play").eq(T).addClass("playing");var s={num:$(".s-num").eq(T+1),song:$(".song").eq(T+1),singer:$(".s-singer").eq(T+1),icons:$(".icons").eq(T),time:$(".s-time").eq(T+1)};l(s),f($("audio"),$(".s-item").eq(T)),_=setInterval(m,0),p(),h(T),y(Q,R,Y,Z,T)}}),$(".play-key .next").click(function(){if($(".play-key .pause").hasClass("played")&&1!==$(".s-item").length&&!(0>T)){$(".play").eq(T).removeClass("playing");var e={num:$(".s-num").eq(T+1),song:$(".song").eq(T+1),singer:$(".s-singer").eq(T+1),icons:$(".icons").eq(T),time:$(".s-time").eq(T+1)};o(e),L[0].innerHTML="",L.css("marginTop",0),clearInterval(_),T>=$(".s-item").length-1?T=0:T+=1,$(".play").eq(T).addClass("playing");var s={num:$(".s-num").eq(T+1),song:$(".song").eq(T+1),singer:$(".s-singer").eq(T+1),icons:$(".icons").eq(T),time:$(".s-time").eq(T+1)};l(s),f($("audio"),$(".s-item").eq(T)),_=setInterval(m,0),p(),h(T),y(Q,R,Y,Z,T)}});var U=["mode0","mode1","mode2","mode3"],O=["列表循环","单曲循环","顺序播放","随机播放"],D=0,N=U.length;$(".mode").click(function(){var e=$(this);U.forEach(function(s,i){e.hasClass(s)&&(e.removeClass(s),D=i)}),D++,D>N-1&&(D=0),e.addClass(U[D]),e.find("span").text(O[D]).stop().fadeIn(500).fadeOut(1e3)}),$(".dislike").click(function(){$(this).toggleClass("like")}),$(".pure").click(function(){$(this).toggleClass("pureon"),$(".m-lrc").toggleClass("fullpage"),$(".m-lrc div").toggleClass("wrapper"),lihg=L.find(".highlight").index(),window.innerWidth>767?lihg>2&&L.stop().animate({marginTop:d(lihg)-L.find("li").eq(lihg-2).height()},300):lihg>0&&L.stop().animate({marginTop:d(lihg)-L.find("li").eq(lihg-2).height()},300)}),$(".horn").click(function(){$(this).toggleClass("silent"),$("audio")[0].muted=!$("audio")[0].muted});var P,X=$(".bot .progress").offset().left,E=$(".bot .progress").width(),S=0;$(".bot").click(function(e){if(e.stopPropagation(),e.preventDefault(),void 0!==T){clearInterval(W),X=$(".bot .progress").offset().left,E=$(".bot .progress").width(),P=e.pageX-X,u(E,$(".bot .song-bar"),$(".bot .dot"),P),S=P/E,$("audio")[0].currentTime=$("audio")[0].duration*S,k=$("audio")[0].duration*S,Y[0].innerText=b($("audio")[0].duration*S);var s,i=L.children();i.removeClass("highlight"),$.each(M,function(e,i){return i>=$("audio")[0].duration*S?(s=e,!1):void 0}),i.eq(s).addClass("highlight"),s>2?L.stop().animate({marginTop:d(s)-L.find("li").eq(s-2).height()},500):L.stop().animate({marginTop:0},500),$(".pause").hasClass("played")&&p()}});var G=!1;$(".dot").on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),void 0!==T&&(clearInterval(W),X=$(".bot .progress").offset().left,E=$(".bot .progress").width(),G=!0,$(document).off("mousemove").on("mousemove",function(e){P=e.pageX-X,u(E,$(".bot .song-bar"),$(".bot .dot"),P),S=P/E,S>1?S=1:0>S&&(S=0),Y[0].innerText=b($("audio")[0].duration*S);var s,i=L.children();i.removeClass("highlight"),$.each(M,function(e,i){return i>=$("audio")[0].duration*S?(s=e,!1):void 0}),i.eq(s).addClass("highlight"),s>2?L.stop().animate({marginTop:d(s)-L.find("li").eq(s-2).height()},500):L.stop().animate({marginTop:0},500)}))}),$(document).off("mouseup").on("mouseup",function(){$(document).off("mousemove"),G&&($("audio")[0].currentTime=$("audio")[0].duration*S,k=$("audio")[0].duration*S,G=!1,$(".pause").hasClass("played")&&p())});var W,_,B,z,A,F,J;$(".volume-progress").click(function(e){e.stopPropagation(),e.preventDefault(),z=$(".volume .progress").width(),A=$(".volume .progress").offset().left,J=e.pageX-A,u(z,$(".volume .progress-bar"),$(".vol-dot"),J),F=J/z,$("audio")[0].volume=F}),$(".vol-dot").on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),z=$(".volume .progress").width(),A=$(".volume .progress").offset().left,$(document).off("mousemove").on("mousemove",function(e){J=e.pageX-A,u(z,$(".volume .progress-bar"),$(".volume .vol-dot"),J),F=J/z,F>1?F=1:0>F&&(F=0),$("audio")[0].volume=F})});var K=$(".cover img"),Q=$(".curName"),R=$(".curSinger"),V=$(".album")[0],Y=$(".ct"),Z=$(".tt"),es=$(".mask-bg")});