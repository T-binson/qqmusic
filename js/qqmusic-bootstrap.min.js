$(function(){function s(s){$(".popup-win").css("display","block"),s.css("display","none"),$(".delkey").on("click",function(){s.css("display","block"),$(".popup-win").css("display","none"),$(".btn-del").off("click")}),$(".btn-cel").on("click",function(){s.css("display","block"),$(".popup-win").css("display","none"),$(".btn-del").off("click")})}function e(){$(".btn-del").on("click",function(){$(".popup-win").css("display","none"),$(".s-item").remove(),$(".s-title .square").removeClass("active"),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),q.splice(0,$(".s-item").length),clearInterval(E),A[0].innerText="",F[0].innerText="",K[0].innerText="00:00",Q[0].innerText="00:00",J.innerText="",z.attr("src","../images/cover10.png"),R.css({backgroundImage:"url(../images/cover10.png)",transition:"all 1s"}),$(".bot .progress-bar").css("width",0),$(".bot .dot").css("left",0),M[0].innerHTML="",M.css("marginTop",0),$(this).off("click")})}function i(s){$.each(s.splice(0,s.length),function(s,e){e.innerText=s+1})}function n(){var s=$(".s-item").eq(C);s.find(".play").addClass("playing"),s.find(".play").addClass("playing"),s.find(".s-num").addClass("wave"),s.find(".s-num").find("b").fadeOut(0),s.find(".song").addClass("actived"),s.find(".s-singer").addClass("actived"),s.find(".icons").css("opacity",1),s.find(".s-time").find("i").css("display","inline-block"),s.find(".s-time").find("span").css("display","none"),g($("audio"),$(".s-item").eq(C)),p(),f(C),v(A,F,K,Q,C)}function a(){var s=$(".s-item .square:not(.active)");$.each(s,function(s,e){return $(e).parent().index()>C?(C=$(e).parent().index(),!1):void 0})}function t(){var s=0;$.each($(".active"),function(e,i){s=$(i).parent().index()-e-1,q.splice(s,1)})}function o(s){s.num.addClass("wave").find("b").fadeOut(0),s.song.addClass("actived"),s.singer.addClass("actived"),s.icons.css("opacity","1"),s.time.find("i").css("display","inline-block"),s.time.find("span").css("display","none")}function l(s){s.num.removeClass("wave").find("b").fadeIn(0),s.song.removeClass("actived"),s.singer.removeClass("actived"),s.icons.attr("style",""),s.time.find("i").attr("style",""),s.time.find("span").attr("style","")}function r(s,e,i,n){$(".play").eq(e).removeClass("playing");var a={num:$(".s-num").eq(e+1),song:$(".song").eq(e+1),singer:$(".s-singer").eq(e+1),icons:$(".icons").eq(e),time:$(".s-time").eq(e+1)};if(l(a),M[0].innerHTML="",M.css("marginTop",0),s.hasClass("mode2")){if(e>=i)return n[0].pause(),clearInterval(E),void $(".play-key .pause").removeClass("play");C+=1}else s.hasClass("mode0")?e>=i?C=0:C+=1:s.hasClass("mode1")?C=e:s.hasClass("mode3")&&(C=c(0,i));g($("audio"),$(".s-item").eq(C)),p(),f(C),v(A,F,K,Q,C),$(".play").eq(C).addClass("playing");var t={num:$(".s-num").eq(C+1),song:$(".song").eq(C+1),singer:$(".s-singer").eq(C+1),icons:$(".icons").eq(C),time:$(".s-time").eq(C+1)};o(t)}function c(s,e){return parseInt(Math.random()*(e-s+1))}function d(s,e,i,n){n>s?n=s:0>n&&(n=0),e.css("width",n),i.css("left",n)}function u(){b=$("audio")[0].duration,curTime=$("audio")[0].currentTime,O=$(".bot .progress").width()*(curTime/b),$(".bot .progress-bar").css("width",O),$(".bot .dot").css("left",O),K[0].innerText=h(curTime),b===curTime&&r($(".mode"),C,$(".s-item").length-1,$("audio")),-1!==k.indexOf(h(curTime))&&(M.children().removeClass("highlight"),$(M.children()[k.indexOf(h(curTime))]).addClass("highlight"),lihg=M.find(".highlight").index(),lihg>2&&M.stop().animate({marginTop:(2-lihg)*$(".highlight").height()},300))}function p(){clearInterval(E);E=setInterval(u,1e3)}function g(s,e,i){var n=q[e.index()].src;s.attr("src","../"+n),i&&(s[0].currentTime=i),s[0].play()}function m(s){$.ajax({url:s,dataType:"json",type:"GET",success:function(s){for(var e=s.length,i="",n=0;e>n;n++){var a='<li class="s-item">\n								<span class="square"></span>\n								<div class="row">\n									<div class="s-name col-7 col-md-7">\n										<div>\n											<i class="s-num"><b>'+(n+1)+'</b></i>\n											<p class="song">'+s[n].songname+'</p>\n										</div>\n										<ul class="icons">\n											<li><a href="javascript:;" class="play"></a></li>\n											<li><a href="javascript:;" class="download"></a></li>\n											<li><a href="javascript:;" class="add"></a></li>\n											<li><a href="javascript:;" class="share"></a></li>\n										</ul>\n									</div>\n									<div class="s-singer col-3 col-md-3">'+s[n].singer+'</div>\n									<div class="s-time col-2 col-md-2">\n										<i class="del"></i>\n										<span class="duration">'+s[n].duration+"</span>\n									</div>\n								</div>\n						</li>";i+=a}$("#mCSB_1_container").append($(i)),q=s},error:function(){alert("the internet doesn't work!")}})}function f(s){var e="";$.ajax({url:q[s].lyric,type:"GET",dataType:"text",success:function(s){var i=/(\d*:\d*)\.\d*\](.*)/g,n=s.match(i);k=[],x=[],w=[];for(var a=0;a<n.length;a++){var t=n[a].split("]");w.push(t[0]),k.push(t[0].split(".")[0]),x.push(t[1])}for(var o=0;o<k.length;o++)e+="<li>"+x[o]+"</li>";M[0].innerHTML=e,y(w),w.splice(0,w.length/2)},error:function(s){console.log(s)}})}function v(s,e,i,n,a,t){s.text(q[a].songname),$("title").text(q[a].songname+" - "+q[a].singer),e.text(q[a].singer),J.innerText=q[a].album,z.attr("src",q[a].cover),R.css("backgroundImage","url("+q[a].cover+")"),K[0].innerText=t?h(t):"00:00",Q[0].innerText=q[a].duration}function h(s){var e=parseInt(s/60);10>e&&(e="0"+e);var i=parseInt(s%60);return 10>i&&(i="0"+i),e+":"+i}function y(s){$.each(s,function(e,i){s.push(Number(60*Number(i.slice(0,2))+Number(i.slice(3,5))+i.slice(5)))})}$(".s-lists").mCustomScrollbar();var q,C,b,T,k=[],x=[],w=[],I="source/songlists.json";m(I);var M=$(".m-lrc ul");$(".m-lists").delegate(".square","click",function(){$(this).toggleClass("active"),"s-title"===$(this).parent().attr("class")?$(this).hasClass("active")?$(".square").addClass("active"):$(".square").removeClass("active"):$(".s-lists .square").length===$(".s-lists .active").length?$(".s-title .square").addClass("active"):$(".s-title .square").removeClass("active")}),$(".navbar .empty").click(function(){0!==$(".s-item").length&&(s($(".remove")),e())}),$(".navbar .delete").click(function(){0!==$(".s-item").length&&$(".square").hasClass("active")&&(s($(".clear")),$(".s-title .square").hasClass("active")&&e(),$(".s-item .square").hasClass("active")&&$(".btn-del").on("click",function(){if($(".popup-win").css("display","none"),$(".clear").css("display","block"),$(".active").siblings().find(".play").hasClass("playing"))C=$(".playing").parentsUntil(".s-lists").eq(4).index(),C===$(".s-item").length-1?C=0:a(),M[0].innerHTML="",M.css("marginTop",0),n(),t();else if(C){var s=q[C];t(),-1===q.indexOf(s)?a():C=q.indexOf(s),M[0].innerHTML="",M.css("marginTop",0)}else t();$(".active").parent().remove();var e=$(".s-num b");i(e),$(".s-item").find(".play").hasClass("playing")&&(C=$(".playing").parentsUntil(".s-lists").eq(4).index()),$(this).off("click")}))}),$(".s-lists").delegate(".del","click",function(){var s=$(this).parentsUntil(".s-lists").eq(2),e=s.siblings().find("b");if(M[0].innerHTML="",M.css("marginTop",0),s.find(".play").hasClass("playing")){if(C=$(".playing").parentsUntil(".s-lists").eq(4).index(),1===$(".s-item").length)return s.remove(),q.splice(s.index(),1),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),clearInterval(E),A[0].innerText="",F[0].innerText="",K[0].innerText="00:00",Q[0].innerText="00:00",J.innerText="",z.attr("src","../images/cover10.png"),R.css({backgroundImage:"url(../images/cover10.png)",transition:"all 1s"}),$(".bot .progress-bar").css("width",0),$(".bot .dot").css("left",0),M[0].innerHTML="",void M.css("marginTop",0);C===$(".s-item").length-1?C=0:C+=1,n()}s.remove(),q.splice(s.index(),1),i(e),$(".s-item").find(".play").hasClass("playing")&&(C=$(".playing").parentsUntil(".s-lists").eq(4).index())});var H;$(".s-lists").delegate(".play","click",function(){$(this).toggleClass("playing"),C=$(this).parentsUntil(".s-lists").eq(4).index();var s=$(this).parentsUntil(".row"),e=s.eq(2),i={num:e.find(".s-num"),icons:s.eq(1),song:e.find(".song"),singer:e.siblings(".s-singer"),time:e.siblings(".s-time")};$(this).hasClass("playing")?(o(i),$(".play-key .pause").addClass("played"),C!==H&&(T=0,M.css("marginTop",0)),g($("audio"),$(".s-item").eq(C),T),p(),f(C),v(A,F,K,Q,C,T)):(l(i),$(".play-key .pause").removeClass("played"),$("audio")[0].pause(),T=$("audio")[0].currentTime,H=C,clearInterval(E));var n=$(this).parentsUntil(".s-lists").eq(4).siblings(),a={num:n.find(".s-num"),song:n.find(".song"),singer:n.find(".s-singer"),icons:n.find(".icons"),time:n.find(".s-time")};n.find(".play").removeClass("playing"),l(a)}),$(".play-key .pause").click(function(){if(0!==$(".s-item").length){C>$(".s-item").length-1&&(C=0),$(this).toggleClass("played");var s;if($(this).hasClass("played")){if(void 0===C){$(".play").eq(0).addClass("playing");var e={num:$(".s-num").eq(1),song:$(".song").eq(1),singer:$(".s-singer").eq(1),icons:$(".icons").eq(0),time:$(".s-time").eq(1)};o(e),C=0,s=$(".s-item").eq(0)}else{s=$(".s-item").eq(C),s.find(".play").addClass("playing");var i={num:s.find(".s-num"),song:s.find(".song"),singer:s.find(".s-singer"),icons:s.find(".icons"),time:s.find(".s-time")};o(i)}g($("audio"),s,T),p(),f(C),v(A,F,K,Q,C,T)}else{$(".play").removeClass("playing");var n={num:$(".s-num"),song:$(".song"),singer:$(".s-singer"),icons:$(".icons"),time:$(".s-time")};l(n),$("audio")[0].pause(),T=$("audio")[0].currentTime,clearInterval(E)}}}),$(".play-key .pre").click(function(){if($(".play-key .pause").hasClass("played")&&1!==$(".s-item").length&&!(0>C)){$(".play").eq(C).removeClass("playing");var s={num:$(".s-num").eq(C+1),song:$(".song").eq(C+1),singer:$(".s-singer").eq(C+1),icons:$(".icons").eq(C),time:$(".s-time").eq(C+1)};l(s),M[0].innerHTML="",M.css("marginTop",0),0===C?C=$(".s-item").length-1:C>$(".s-item").length-1?C=0:C-=1,$(".play").eq(C).addClass("playing");var e={num:$(".s-num").eq(C+1),song:$(".song").eq(C+1),singer:$(".s-singer").eq(C+1),icons:$(".icons").eq(C),time:$(".s-time").eq(C+1)};o(e),g($("audio"),$(".s-item").eq(C)),p(),f(C),v(A,F,K,Q,C)}}),$(".play-key .next").click(function(){if($(".play-key .pause").hasClass("played")&&1!==$(".s-item").length&&!(0>C)){$(".play").eq(C).removeClass("playing");var s={num:$(".s-num").eq(C+1),song:$(".song").eq(C+1),singer:$(".s-singer").eq(C+1),icons:$(".icons").eq(C),time:$(".s-time").eq(C+1)};l(s),M[0].innerHTML="",M.css("marginTop",0),C>=$(".s-item").length-1?C=0:C+=1,$(".play").eq(C).addClass("playing");var e={num:$(".s-num").eq(C+1),song:$(".song").eq(C+1),singer:$(".s-singer").eq(C+1),icons:$(".icons").eq(C),time:$(".s-time").eq(C+1)};o(e),g($("audio"),$(".s-item").eq(C)),p(),f(C),v(A,F,K,Q,C)}});var L=["mode0","mode1","mode2","mode3"],j=0,U=L.length;$(".mode").click(function(){var s=$(this);L.forEach(function(e,i){s.hasClass(e)&&(s.removeClass(e),j=i)}),j++,j>U-1&&(j=0),s.addClass(L[j])}),$(".dislike").click(function(){$(this).toggleClass("like")}),$(".pure").click(function(){$(this).toggleClass("pureon"),$(".m-lrc").toggleClass("fullpage"),$(".m-lrc div").toggleClass("wrapper"),lihg=M.find(".highlight").index(),lihg>2&&M.stop().animate({marginTop:(2-lihg)*$(".highlight").height()},300)}),$(".horn").click(function(){$(this).toggleClass("silent"),$("audio")[0].muted=!$("audio")[0].muted});var O,D=$(".bot .progress").offset().left,N=$(".bot .progress").width(),P=0;$(".bot").click(function(s){if(s.stopPropagation(),s.preventDefault(),void 0!==C){clearInterval(E),D=$(".bot .progress").offset().left,N=$(".bot .progress").width(),O=s.pageX-D,d(N,$(".bot .progress-bar"),$(".bot .dot"),O),P=O/N,$("audio")[0].currentTime=$("audio")[0].duration*P,T=$("audio")[0].duration*P,K[0].innerText=h($("audio")[0].duration*P);var e,i=M.children();i.removeClass("highlight"),$.each(w,function(s,i){return i>=$("audio")[0].duration*P?(e=s,!1):void 0}),i.eq(e).addClass("highlight"),e>2?M.stop().animate({marginTop:-(e-2)*$(i[0]).height()},500):M.stop().animate({marginTop:0},500),$(".pause").hasClass("played")&&p()}});var X=!1;$(".dot").on("mousedown",function(s){s.preventDefault(),s.stopPropagation(),void 0!==C&&(clearInterval(E),D=$(".bot .progress").offset().left,N=$(".bot .progress").width(),X=!0,$(document).off("mousemove").on("mousemove",function(s){O=s.pageX-D,d(N,$(".bot .progress-bar"),$(".bot .dot"),O),P=O/N,P>1?P=1:0>P&&(P=0),K[0].innerText=h($("audio")[0].duration*P);var e,i=M.children();i.removeClass("highlight"),$.each(w,function(s,i){return i>=$("audio")[0].duration*P?(e=s,!1):void 0}),i.eq(e).addClass("highlight"),e>2?M.stop().animate({marginTop:-(e-2)*$(i[0]).height()},500):M.stop().animate({marginTop:0},500)}))}),$(document).off("mouseup").on("mouseup",function(){$(document).off("mousemove"),X&&($("audio")[0].currentTime=$("audio")[0].duration*P,T=$("audio")[0].duration*P,X=!1,$(".pause").hasClass("played")&&p())});var E,S,G,_,B;$(".volume-progress").click(function(s){s.stopPropagation(),s.preventDefault(),S=$(".volume .progress").width(),G=$(".volume .progress").offset().left,B=s.pageX-G,d(S,$(".volume .progress-bar"),$(".vol-dot"),B),_=B/S,$("audio")[0].volume=_}),$(".vol-dot").on("mousedown",function(s){s.preventDefault(),s.stopPropagation(),S=$(".volume .progress").width(),G=$(".volume .progress").offset().left,$(document).off("mousemove").on("mousemove",function(s){B=s.pageX-G,d(S,$(".volume .progress-bar"),$(".volume .vol-dot"),B),_=B/S,_>1?_=1:0>_&&(_=0),$("audio")[0].volume=_})});var z=$(".cover img"),A=$(".curName"),F=$(".curSinger"),J=$(".album")[0],K=$(".ct"),Q=$(".tt"),R=$(".mask-bg")});